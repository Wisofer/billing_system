@{
    var estado = ViewBag.Estado as string ?? "Todos";
    var mes = ViewBag.Mes as int?;
    var año = ViewBag.Año as int? ?? DateTime.Now.Year;
    var busquedaCliente = ViewBag.BusquedaCliente as string ?? "";
    var clientes = ViewBag.Clientes as List<billing_system.Models.Entities.Cliente> ?? new List<billing_system.Models.Entities.Cliente>();
    var mesActual = DateTime.Now.Month;
}

<div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-5 mb-6">
    <form method="get" action="/facturas" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <input type="hidden" name="pagina" value="1" />
        
        <div>
            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Mes</label>
            <select name="mes" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Todos los meses</option>
                @for (int i = 1; i <= 12; i++)
                {
                    var fecha = new DateTime(año, i, 1);
                    // Si no hay mes seleccionado (primera carga), seleccionar el mes actual
                    // Si hay un mes seleccionado, usar ese
                    var seleccionado = mes.HasValue ? (mes == i) : (i == mesActual);
                    <option value="@i" @(seleccionado ? "selected" : "")>@fecha.ToString("MMMM yyyy")</option>
                }
            </select>
        </div>
        
        <div>
            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Año</label>
            <select name="año" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                @for (int y = DateTime.Now.Year; y >= DateTime.Now.Year - 2; y--)
                {
                    <option value="@y" @(año == y ? "selected" : "")>@y</option>
                }
            </select>
        </div>
        
        <div>
            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Estado</label>
            <select name="estado" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="Todos" @(estado == "Todos" ? "selected" : "")>Todos los estados</option>
                <option value="Pagada" @(estado == "Pagada" ? "selected" : "")>Pagada</option>
                <option value="Pendiente" @(estado == "Pendiente" ? "selected" : "")>Pendiente</option>
                <option value="Cancelada" @(estado == "Cancelada" ? "selected" : "")>Cancelada</option>
            </select>
        </div>
        
        <div>
            <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Buscar Cliente</label>
            <input type="text" name="busquedaCliente" value="@busquedaCliente" placeholder="Nombre o código..." 
                   class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div class="md:col-span-4 flex items-end space-x-2">
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                Filtrar
            </button>
            <a href="/facturas" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm font-medium text-gray-700 dark:text-gray-300">
                Limpiar
            </a>
        </div>
    </form>
</div>

